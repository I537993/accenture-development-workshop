_schema-version: "3.1"
ID: coffeeshop
version: 1.0.0
description: "A simple CAP project."
parameters:
  enable-parallel-deployments: true
# build-parameters:
#     - builder: custom
#       commands:
#         - npx -p @sap/cds-dk cds build --production
modules:
### DESTINATION GACD ###
- name: coffeeshop-destination-content
  type: com.sap.application.content
  build-parameters:
    no-source: true # must be set so that module path is not required.
  requires: 
  - name: coffeeshop-auth
  - name: coffeeshop-repo-host
  - name: coffeeshop-destination
    parameters:
      content-target: true
  parameters:
    content:
      instance:
        existing_destinations_policy: update
        destinations:
        - Name: repo
          ServiceInstanceName: coffeeshop-repo-host
          ServiceKeyName: coffeeshop-html-repo-key
          sap.cloud.service: com.manis.coffeeshop # set this in your manifest.json
        - Authentication: OAuth2UserTokenExchange
          Name: uaa
          sap.cloud.service: com.manis.coffeeshop # set this in your manifest.json
          ServiceInstanceName: coffeeshop-auth
          ServiceKeyName: coffeeshop-auth-key
### HTML5 GACD ###
- name: coffeeshop-app-content
  type: com.sap.application.content
  path: .
  requires:
  - name: coffeeshop-repo-host
    parameters:
      content-target: true
  build-parameters:
    build-result: resources
    requires:
    - artifacts:
      - content.zip
      name: html5-content
      target-path: resources/
### HTML5 CONTENT ###
- name: html5-content
  type: html5
  path: app
  build-parameters:
    build-result: dist
    builder: custom
    commands:
    - npm install
    - npm run build
    supported-platforms: []
resources:
  # XSUAA SERVICE
  - name: coffeeshop-auth
    type: org.cloudfoundry.managed-service
    parameters:
      service: xsuaa
      service-plan: application
      service-keys:
        - name: coffeeshop-auth-key
      path: ./xs-security.json
      config:
        xsappname: coffeeshop
        tenant-mode: dedicated
  # LOGGING SERVICE
  - name: coffeeshop-cf-logging
    type: org.cloudfoundry.managed-service
    parameters:
      service: application-logs
      service-plan: lite
  # HTML REPO SERVICE
  - name: coffeeshop-repo-host
    type: org.cloudfoundry.managed-service
    parameters:
      service: html5-apps-repo
      service-plan: app-host
      service-keys:
        - name: coffeeshop-html-repo-key
  # DESTINATION SERVICE
  - name: coffeeshop-destination
    type: org.cloudfoundry.managed-service
    parameters:
      service: destination
      service-plan: lite
      config:
        HTML5Runtime_enabled: "true"